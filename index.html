<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LIVE STATS ‚Äî Football</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600;700&family=Orbitron:wght@700;800;900&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #080c10;
  --surface: #0f141a;
  --card: #141c24;
  --border: #1e2730;
  --border2: #252f3a;
  --accent: #00e676;
  --accent-dim: rgba(0,230,118,0.1);
  --accent-glow: rgba(0,230,118,0.25);
  --blue: #448aff;
  --red: #ff3d57;
  --yellow: #ffca28;
  --text: #e8edf3;
  --text2: #a8b4c0;
  --muted: #5a6a7a;
  --live: #ff3d57;
  --header: #060a0d;
  --radius: 10px;
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;font-size:13px;min-height:100vh;overflow-x:hidden;}
::-webkit-scrollbar{width:4px;height:4px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--border2);border-radius:4px;}

/* HEADER */
.header{background:var(--header);border-bottom:1px solid var(--border);position:sticky;top:0;z-index:200;}
.header-inner{display:flex;align-items:center;justify-content:space-between;padding:0 20px;height:54px;max-width:1440px;margin:0 auto;}
.logo{display:flex;align-items:center;gap:10px;text-decoration:none;}
.logo-icon{width:40px;height:40px;flex-shrink:0;animation:ballglow 2.8s ease-in-out infinite alternate;}
@keyframes ballglow{from{filter:drop-shadow(0 0 4px rgba(255,255,255,0.3)) drop-shadow(0 0 8px rgba(0,230,118,0.3));}to{filter:drop-shadow(0 0 8px rgba(255,255,255,0.5)) drop-shadow(0 0 18px rgba(0,230,118,0.6));}}
.logo-text{font-family:'Orbitron',sans-serif;font-size:16px;font-weight:800;letter-spacing:2px;color:var(--text);display:flex;align-items:center;gap:9px;}
.logo-text em{color:var(--accent);font-style:normal;}
.logo-live-dot{width:8px;height:8px;border-radius:50%;background:var(--live);flex-shrink:0;box-shadow:0 0 8px rgba(255,61,87,0.9);animation:livedotpulse 1.1s ease-in-out infinite;}
@keyframes livedotpulse{0%,100%{transform:scale(1);box-shadow:0 0 5px rgba(255,61,87,0.7);}50%{transform:scale(1.5);box-shadow:0 0 14px rgba(255,61,87,1);}}
.header-right{display:flex;align-items:center;gap:14px;}
.live-indicator{display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text2);}
.live-dot{width:7px;height:7px;background:var(--live);border-radius:50%;animation:blink 1s infinite;}
@keyframes blink{0%,100%{opacity:1;}50%{opacity:0.2;}}
.btn-refresh{background:var(--accent-dim);border:1px solid rgba(0,230,118,0.2);color:var(--accent);padding:6px 14px;border-radius:7px;cursor:pointer;font-size:11px;font-weight:600;font-family:'DM Sans',sans-serif;transition:all 0.2s;display:flex;align-items:center;gap:6px;}
.btn-refresh:hover{background:rgba(0,230,118,0.18);border-color:rgba(0,230,118,0.4);}
.btn-refresh:disabled{opacity:0.4;cursor:default;}
.countdown-badge{font-size:11px;color:var(--muted);background:var(--surface);border:1px solid var(--border);padding:4px 9px;border-radius:6px;font-variant-numeric:tabular-nums;}

/* NAV TABS */
.nav-row{border-bottom:1px solid var(--border);background:var(--header);}
.nav-tabs{display:flex;gap:0;overflow-x:auto;padding:0 20px;max-width:1440px;margin:0 auto;scrollbar-width:none;}
.nav-tabs::-webkit-scrollbar{display:none;}
.nav-tab{padding:11px 18px;cursor:pointer;font-size:12px;font-weight:600;color:var(--muted);border-bottom:2px solid transparent;white-space:nowrap;transition:all 0.15s;letter-spacing:0.3px;background:none;border-top:none;border-left:none;border-right:none;font-family:'DM Sans',sans-serif;display:flex;align-items:center;gap:6px;}
.nav-tab:hover{color:var(--text2);}
.nav-tab.active{color:var(--accent);border-bottom-color:var(--accent);}
.nav-tab .tab-dot{width:6px;height:6px;border-radius:50%;background:var(--live);animation:blink 1s infinite;display:none;}
.nav-tab.active .tab-dot{display:block;}
.nav-tab .tab-badge{background:var(--live);color:#fff;font-size:9px;font-weight:700;padding:1px 5px;border-radius:10px;}

/* LAYOUT */
.layout{display:flex;max-width:1440px;margin:0 auto;}

/* SIDEBAR */
.sidebar{width:210px;flex-shrink:0;border-right:1px solid var(--border);padding:14px 0;position:sticky;top:88px;height:calc(100vh - 88px);overflow-y:auto;}
.sidebar-section{margin-bottom:2px;}
.sidebar-label{padding:10px 16px 5px;font-size:10px;font-weight:700;color:var(--muted);letter-spacing:1.5px;text-transform:uppercase;}
.sidebar-item{padding:9px 16px;cursor:pointer;display:flex;align-items:center;gap:10px;transition:all 0.12s;border-left:2px solid transparent;position:relative;}
.sidebar-item:hover{background:var(--surface);}
.sidebar-item.active{background:var(--accent-dim);border-left-color:var(--accent);}
.sidebar-item.active .s-name{color:var(--accent);}
.s-flag{font-size:14px;width:18px;text-align:center;}
.s-name{font-size:12px;font-weight:500;color:var(--text2);flex:1;}
.sidebar-item.active .s-name{color:var(--accent);}
.s-count{font-size:10px;color:var(--muted);background:var(--border);padding:1px 6px;border-radius:8px;}

/* MAIN */
.main{flex:1;min-width:0;}

/* DATE BAR */
.date-bar{display:flex;align-items:center;gap:6px;padding:10px 16px;border-bottom:1px solid var(--border);background:var(--surface);overflow-x:auto;scrollbar-width:none;}
.date-bar::-webkit-scrollbar{display:none;}
.date-btn{padding:5px 13px;border-radius:7px;cursor:pointer;font-size:11px;font-weight:600;white-space:nowrap;background:none;border:1px solid var(--border2);color:var(--muted);font-family:'DM Sans',sans-serif;transition:all 0.15s;}
.date-btn:hover{border-color:var(--accent);color:var(--text);}
.date-btn.active{background:var(--accent);color:#000;border-color:var(--accent);}

/* LEAGUE BLOCK */
.league-block{border-bottom:1px solid var(--border);}
.league-header{display:flex;align-items:center;gap:10px;padding:9px 16px;background:var(--surface);cursor:pointer;user-select:none;transition:background 0.12s;}
.league-header:hover{background:var(--card);}
.l-flag{font-size:15px;}
.l-name{font-family:'Space Grotesk',sans-serif;font-size:12px;font-weight:700;letter-spacing:0.3px;text-transform:uppercase;color:var(--text2);}
.l-sub{font-size:10px;color:var(--muted);background:var(--border);padding:1px 6px;border-radius:5px;}
.l-count{margin-left:auto;font-size:10px;color:var(--muted);}
.l-toggle{font-size:10px;color:var(--muted);transition:transform 0.2s;}
.league-block.collapsed .l-toggle{transform:rotate(-90deg);}
.league-block.collapsed .league-games{display:none;}

/* MATCH ROW */
.match-row{display:grid;grid-template-columns:72px 1fr 70px 1fr 80px;align-items:center;padding:0 16px;height:50px;border-bottom:1px solid rgba(30,39,48,0.6);cursor:pointer;transition:all 0.12s;position:relative;}
.match-row::before{content:'';position:absolute;left:0;top:0;bottom:0;width:0;background:var(--accent);transition:width 0.15s;}
.match-row:hover{background:var(--surface);}
.match-row:hover::before{width:3px;}
.match-row.live-match{background:rgba(255,61,87,0.03);}
.match-row.live-match::before{background:var(--live);}
.match-row.live-match:hover::before{width:3px;}
.match-row:last-child{border-bottom:none;}

.m-time{font-size:11px;font-weight:500;display:flex;flex-direction:column;gap:1px;}
.m-live{color:var(--live);font-size:10px;font-weight:700;letter-spacing:0.5px;display:flex;align-items:center;gap:4px;}
.m-live-dot{width:5px;height:5px;border-radius:50%;background:var(--live);animation:blink 1s infinite;}
.m-min{font-size:11px;color:var(--live);font-weight:700;}
.m-ft{color:var(--muted);font-size:10px;font-weight:700;}
.m-sch-time{color:var(--text2);font-size:11px;}
.m-date{font-size:10px;color:var(--muted);}

.team-col{display:flex;align-items:center;gap:8px;overflow:hidden;}
.team-col.away{flex-direction:row-reverse;}
.team-badge{width:26px;height:26px;border-radius:6px;flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:8px;font-weight:800;color:#fff;font-family:'Space Grotesk',sans-serif;letter-spacing:0.5px;position:relative;}
.team-badge::after{content:'';position:absolute;inset:0;border-radius:6px;box-shadow:inset 0 -2px 0 rgba(0,0,0,0.3);}
.team-name{font-size:12px;font-weight:500;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:130px;color:var(--text2);}
.team-name.winner{font-weight:700;color:var(--text);}

.score-col{text-align:center;display:flex;flex-direction:column;align-items:center;gap:2px;}
.score-nums{font-family:'Space Grotesk',sans-serif;font-size:17px;font-weight:700;letter-spacing:2px;display:flex;align-items:center;gap:4px;}
.score-nums.live-c{color:var(--live);}
.s-dash{color:var(--muted);font-weight:400;font-size:14px;}
.score-probs{font-size:9px;color:var(--muted);letter-spacing:0.3px;}
.score-vs{font-size:12px;color:var(--muted);letter-spacing:2px;font-family:'Space Grotesk',sans-serif;}

.m-tag{font-size:9px;padding:2px 6px;border-radius:4px;font-weight:600;letter-spacing:0.3px;text-align:center;display:inline-block;}
.tag-live{background:rgba(255,61,87,0.15);color:var(--live);}
.tag-ft{background:var(--border);color:var(--muted);}
.tag-sch{background:rgba(255,202,40,0.1);color:var(--yellow);}

/* STANDINGS */
.standings-wrapper{padding:16px;}
.std-league-tabs{display:flex;gap:6px;padding:12px 16px;border-bottom:1px solid var(--border);overflow-x:auto;scrollbar-width:none;background:var(--surface);}
.std-league-tabs::-webkit-scrollbar{display:none;}
.std-league-tab{padding:6px 14px;border-radius:7px;cursor:pointer;font-size:11px;font-weight:600;white-space:nowrap;background:none;border:1px solid var(--border2);color:var(--muted);font-family:'DM Sans',sans-serif;transition:all 0.15s;}
.std-league-tab:hover{border-color:var(--accent);color:var(--text);}
.std-league-tab.active{background:var(--accent);color:#000;border-color:var(--accent);}
.standings-table-wrap{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;margin-bottom:16px;}
table.stable{width:100%;border-collapse:collapse;}
table.stable thead tr{background:var(--card);}
table.stable th{padding:9px 10px;font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:0.8px;text-align:center;border-bottom:1px solid var(--border);font-family:'Space Grotesk',sans-serif;}
table.stable th:first-child,table.stable th:nth-child(2){text-align:left;}
table.stable tbody tr{border-bottom:1px solid rgba(30,39,48,0.6);transition:background 0.1s;}
table.stable tbody tr:hover{background:var(--card);cursor:pointer;}
table.stable tbody tr:last-child{border-bottom:none;}
table.stable td{padding:9px 10px;font-size:12px;text-align:center;color:var(--text2);}
table.stable td:first-child{text-align:left;}
.stable .rank-num{width:22px;height:22px;border-radius:5px;display:inline-flex;align-items:center;justify-content:center;font-size:11px;font-weight:700;background:var(--border);color:var(--muted);}
.rank-1{background:rgba(255,202,40,0.2)!important;color:var(--yellow)!important;}
.rank-2{background:rgba(200,200,200,0.12)!important;color:#aaa!important;}
.rank-3{background:rgba(180,120,60,0.2)!important;color:#cd7f32!important;}
.zone-cl{border-left:3px solid var(--accent);}
.zone-el{border-left:3px solid var(--blue);}
.zone-rel{border-left:3px solid var(--red);}
.t-badge{width:22px;height:22px;border-radius:5px;display:inline-flex;align-items:center;justify-content:center;font-size:7px;font-weight:800;color:#fff;flex-shrink:0;font-family:'Space Grotesk',sans-serif;}
.team-cell-std{display:flex;align-items:center;gap:8px;}
.t-name-std{font-weight:600;color:var(--text);font-size:12px;cursor:pointer;}
.t-name-std:hover{color:var(--accent);}
.pts-cell{font-weight:700;font-size:13px;color:var(--text)!important;}
.form-pills{display:flex;gap:3px;justify-content:center;}
.fp{width:16px;height:16px;border-radius:3px;font-size:8px;font-weight:700;color:#fff;display:flex;align-items:center;justify-content:center;}
.fp-W{background:#2ea043;}
.fp-D{background:rgba(68,138,255,0.5);}
.fp-L{background:rgba(255,61,87,0.7);}
.zone-legend{display:flex;gap:16px;margin:10px 0;flex-wrap:wrap;}
.zl-item{display:flex;align-items:center;gap:5px;font-size:10px;color:var(--muted);}
.zl-box{width:10px;height:10px;border-radius:2px;}

/* NEWS TAB */
.news-wrapper{padding:0;}
.news-header{padding:14px 20px;border-bottom:1px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:space-between;}
.news-header-left{display:flex;align-items:center;gap:10px;}
.news-title{font-family:'Space Grotesk',sans-serif;font-size:14px;font-weight:700;color:var(--text);}
.news-live-badge{display:flex;align-items:center;gap:5px;font-size:10px;color:var(--live);background:rgba(255,61,87,0.1);padding:3px 8px;border-radius:6px;font-weight:600;}
.news-filter{display:flex;gap:6px;}
.news-cat-btn{padding:4px 11px;border-radius:6px;cursor:pointer;font-size:10px;font-weight:600;background:none;border:1px solid var(--border2);color:var(--muted);font-family:'DM Sans',sans-serif;transition:all 0.15s;}
.news-cat-btn:hover{border-color:var(--text2);color:var(--text);}
.news-cat-btn.active{background:var(--accent);color:#000;border-color:var(--accent);}
.news-feed{padding:16px;display:flex;flex-direction:column;gap:10px;}
.news-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:14px 16px;transition:all 0.15s;cursor:pointer;position:relative;overflow:hidden;}
.news-card::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--accent);opacity:0;}
.news-card:hover{border-color:var(--border2);background:var(--card);}
.news-card:hover::before{opacity:1;}
.news-card.breaking::before{opacity:1;background:var(--live);}
.news-card-top{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;}
.news-source-row{display:flex;align-items:center;gap:8px;margin-bottom:8px;}
.news-source-icon{width:20px;height:20px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:11px;}
.news-source{font-size:10px;color:var(--muted);font-weight:600;}
.news-time{font-size:10px;color:var(--muted);}
.news-breaking-tag{font-size:9px;background:rgba(255,61,87,0.15);color:var(--live);padding:2px 6px;border-radius:4px;font-weight:700;letter-spacing:0.3px;}
.news-headline{font-size:13px;font-weight:600;color:var(--text);line-height:1.4;margin-bottom:6px;}
.news-snippet{font-size:11px;color:var(--text2);line-height:1.5;}
.news-tags{display:flex;gap:5px;margin-top:8px;flex-wrap:wrap;}
.news-tag{font-size:9px;color:var(--muted);background:var(--border);padding:2px 7px;border-radius:4px;font-weight:600;}
.news-loading{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px;gap:14px;color:var(--muted);}
.news-spinner{width:32px;height:32px;border:2px solid var(--border);border-top-color:var(--accent);border-radius:50%;animation:spin 0.7s linear infinite;}
@keyframes spin{to{transform:rotate(360deg);}}
.news-error{padding:30px;text-align:center;color:var(--muted);}
.news-error .err-icon{font-size:32px;margin-bottom:10px;}
.news-retry{margin-top:12px;background:var(--accent-dim);border:1px solid rgba(0,230,118,0.2);color:var(--accent);padding:7px 16px;border-radius:7px;cursor:pointer;font-size:12px;font-family:'DM Sans',sans-serif;}
.news-empty{text-align:center;padding:60px;color:var(--muted);}

/* NEWS ARTICLE MODAL */
.news-article-overlay{position:fixed;inset:0;z-index:2000;display:flex;align-items:stretch;pointer-events:none;opacity:0;transition:opacity 0.25s;}
.news-article-overlay.open{pointer-events:all;opacity:1;}
.na-backdrop{position:absolute;inset:0;background:rgba(0,0,0,0.85);backdrop-filter:blur(8px);}
.na-panel{position:relative;width:min(780px,100vw);margin-left:auto;background:var(--bg);border-left:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;transform:translateX(100%);transition:transform 0.35s cubic-bezier(0.22,1,0.36,1);box-shadow:-30px 0 100px rgba(0,0,0,0.7);}
.news-article-overlay.open .na-panel{transform:translateX(0);}
.na-hero{height:220px;position:relative;flex-shrink:0;overflow:hidden;}
.na-hero-img{position:absolute;inset:0;background-size:cover;background-position:center;}
.na-hero-overlay{position:absolute;inset:0;background:linear-gradient(to top,var(--bg) 0%,rgba(8,12,16,0.3) 100%);}
.na-close{position:absolute;top:14px;right:14px;width:32px;height:32px;border-radius:50%;background:rgba(0,0,0,0.6);border:1px solid rgba(255,255,255,0.15);color:#fff;cursor:pointer;font-size:15px;display:flex;align-items:center;justify-content:center;z-index:10;transition:all 0.15s;backdrop-filter:blur(6px);}
.na-close:hover{background:rgba(255,255,255,0.12);}
.na-body{flex:1;overflow-y:auto;padding:24px;}
.na-meta{display:flex;align-items:center;gap:10px;margin-bottom:14px;flex-wrap:wrap;}
.na-source-icon{font-size:18px;}
.na-source{font-size:11px;font-weight:700;color:var(--accent);}
.na-sep{color:var(--border2);}
.na-time{font-size:11px;color:var(--muted);}
.na-breaking-pill{font-size:9px;font-weight:700;background:var(--live);color:#fff;padding:3px 8px;border-radius:10px;letter-spacing:1px;}
.na-headline{font-family:'Space Grotesk',sans-serif;font-size:20px;font-weight:700;line-height:1.3;color:var(--text);margin-bottom:12px;}
.na-tags{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:18px;}
.na-tag{font-size:10px;color:var(--muted);background:var(--surface);border:1px solid var(--border);padding:3px 9px;border-radius:12px;font-weight:600;}
.na-divider{height:1px;background:var(--border);margin-bottom:18px;}
.na-content{font-size:13px;color:var(--text2);line-height:1.8;}
.na-content p{margin-bottom:14px;}
.na-content p:last-child{margin-bottom:0;}
.na-content strong{color:var(--text);}
.na-content blockquote{border-left:3px solid var(--accent);padding:8px 14px;margin:14px 0;background:var(--surface);border-radius:0 6px 6px 0;font-style:italic;color:var(--text2);}

/* H2H TAB */
.h2h-wrapper{padding:14px;}
.h2h-header{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:8px;padding:10px 12px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);margin-bottom:12px;}
.h2h-team{text-align:center;}
.h2h-team-name{font-family:'Space Grotesk',sans-serif;font-size:12px;font-weight:700;color:var(--text2);}
.h2h-team-stat{font-family:'Space Grotesk',sans-serif;font-size:22px;font-weight:800;}
.h2h-label{font-size:10px;color:var(--muted);text-align:center;}
.h2h-vs{font-size:10px;font-weight:700;color:var(--muted);letter-spacing:2px;}
.h2h-match{display:grid;grid-template-columns:1fr 60px 1fr;align-items:center;gap:4px;padding:8px 10px;border-bottom:1px solid rgba(30,39,48,0.5);transition:background 0.1s;}
.h2h-match:last-child{border-bottom:none;}
.h2h-match:hover{background:var(--surface);}
.h2h-home,.h2h-away{font-size:11px;font-weight:500;color:var(--text2);}
.h2h-home{text-align:right;}
.h2h-score{font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:700;text-align:center;letter-spacing:1px;}
.h2h-date{font-size:9px;color:var(--muted);text-align:center;}
.h2h-comp{font-size:9px;color:var(--muted);text-align:center;margin-top:1px;}
.h2h-win-home{color:var(--accent);}
.h2h-win-away{color:var(--blue);}
.h2h-draw{color:var(--muted);}
.h2h-bar-row{display:flex;border-radius:6px;overflow:hidden;height:8px;margin:6px 0;}
.h2h-bar-seg{height:100%;transition:width 0.6s cubic-bezier(0.16,1,0.3,1);}

/* LIVE MINUTE STYLES */
.m-live-clock{font-size:13px;font-weight:800;color:var(--live);font-family:'Space Grotesk',sans-serif;font-variant-numeric:tabular-nums;}
.live-pulse-ring{display:inline-flex;align-items:center;gap:4px;}

/* MODAL */
.modal-overlay{position:fixed;inset:0;z-index:1000;display:flex;justify-content:flex-end;pointer-events:none;opacity:0;transition:opacity 0.25s;}
.modal-overlay.open{pointer-events:all;opacity:1;}
.modal-backdrop{position:absolute;inset:0;background:rgba(0,0,0,0.7);backdrop-filter:blur(6px);}
.modal-panel{position:relative;width:min(700px,100vw);background:var(--bg);border-left:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;transform:translateX(100%);transition:transform 0.35s cubic-bezier(0.22,1,0.36,1);box-shadow:-24px 0 80px rgba(0,0,0,0.6);}
.modal-overlay.open .modal-panel{transform:translateX(0);}
.modal-close{position:absolute;top:14px;right:14px;width:30px;height:30px;border-radius:50%;background:rgba(255,255,255,0.06);border:1px solid var(--border);color:var(--text2);cursor:pointer;font-size:15px;display:flex;align-items:center;justify-content:center;transition:all 0.15s;z-index:10;}
.modal-close:hover{background:rgba(255,255,255,0.12);color:var(--text);}
.modal-header{background:linear-gradient(160deg,#060a0d 0%,#0f141a 100%);padding:20px 20px 0;border-bottom:1px solid var(--border);flex-shrink:0;position:relative;}
.modal-league-info{display:flex;align-items:center;gap:6px;margin-bottom:14px;}
.modal-league-info .flag{font-size:13px;}
.modal-league-info .league-name{font-family:'Space Grotesk',sans-serif;font-size:11px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--muted);}
.match-hero{display:grid;grid-template-columns:1fr auto 1fr;align-items:center;gap:16px;margin-bottom:14px;}
.mh-team{display:flex;flex-direction:column;align-items:center;gap:8px;}
.mh-badge{width:54px;height:54px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-family:'Space Grotesk',sans-serif;font-size:14px;font-weight:800;color:#fff;letter-spacing:1px;flex-shrink:0;box-shadow:0 6px 20px rgba(0,0,0,0.5);}
.mh-name{font-family:'Space Grotesk',sans-serif;font-size:15px;font-weight:700;text-align:center;line-height:1.1;}
.mh-formation{font-size:10px;color:var(--muted);}
.mh-score-center{display:flex;flex-direction:column;align-items:center;gap:5px;}
.mh-score{font-family:'Orbitron',sans-serif;font-size:42px;font-weight:800;letter-spacing:4px;line-height:1;}
.mh-score.live{color:var(--live);}
.mh-score .sdash{color:var(--muted);font-weight:400;}
.mh-status{font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;}
.mh-status.ft{color:var(--muted);}
.mh-status.live{color:var(--live);animation:blink 1s infinite;}
.mh-status.sch{color:var(--yellow);}
.mh-ht{font-size:10px;color:var(--muted);}
.modal-meta{display:flex;align-items:center;gap:14px;padding-bottom:12px;font-size:11px;color:var(--muted);}
.modal-meta span{display:flex;align-items:center;gap:4px;}
.modal-tabs{display:flex;border-bottom:1px solid var(--border);background:var(--surface);flex-shrink:0;overflow-x:auto;scrollbar-width:none;}
.modal-tabs::-webkit-scrollbar{display:none;}
.modal-tab{padding:11px 16px;cursor:pointer;font-size:11px;font-weight:600;color:var(--muted);border-bottom:2px solid transparent;white-space:nowrap;transition:all 0.15s;letter-spacing:0.5px;text-transform:uppercase;background:none;border-top:none;border-left:none;border-right:none;font-family:'DM Sans',sans-serif;}
.modal-tab:hover{color:var(--text2);}
.modal-tab.active{color:var(--accent);border-bottom-color:var(--accent);}
.modal-body{flex:1;overflow-y:auto;}
.tab-panel{display:none;}
.tab-panel.active{display:block;}

/* OVERVIEW */
.overview-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;padding:14px;}
@media(max-width:480px){.overview-grid{grid-template-columns:1fr;}}
.ov-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:12px;}
.ov-card-full{grid-column:1/-1;}
.ov-title{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin-bottom:10px;font-family:'Space Grotesk',sans-serif;}
.goal-line{display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid rgba(30,39,48,0.5);font-size:12px;}
.goal-line:last-child{border-bottom:none;}
.goal-min{font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:700;color:var(--accent);width:30px;flex-shrink:0;}
.goal-icon{font-size:13px;}
.goal-player{font-weight:600;}
.goal-team{font-size:10px;color:var(--muted);}
.potm-wrap{display:flex;align-items:center;gap:12px;}
.potm-badge{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;color:#fff;flex-shrink:0;font-family:'Space Grotesk',sans-serif;}
.potm-info{}
.potm-name{font-weight:700;font-size:13px;}
.potm-detail{font-size:10px;color:var(--muted);margin-top:2px;}
.potm-rating{font-family:'Space Grotesk',sans-serif;font-size:16px;font-weight:700;color:var(--accent);}

/* STATS */
.stats-wrapper{padding:14px;}
.stat-row{margin-bottom:14px;}
.stat-label{display:flex;justify-content:space-between;font-size:11px;font-weight:600;margin-bottom:5px;}
.stat-label .sv{color:var(--text);}
.stat-track{display:flex;height:5px;background:var(--border);border-radius:3px;overflow:hidden;}
.stat-bar-home{height:100%;border-radius:3px 0 0 3px;background:linear-gradient(to right, #00e676, #00c853);width:0;transition:width 0.8s cubic-bezier(0.16,1,0.3,1);}
.stat-bar-away{height:100%;border-radius:0 3px 3px 0;background:linear-gradient(to left, #448aff, #1565c0);width:0;transition:width 0.8s cubic-bezier(0.16,1,0.3,1);}
.stat-poss-row{display:flex;margin-bottom:14px;}
.poss-bar{height:6px;transition:width 0.8s cubic-bezier(0.16,1,0.3,1);}
.stat-cat{font-size:10px;font-weight:700;color:var(--muted);text-transform:uppercase;letter-spacing:1px;padding:10px 0 5px;border-bottom:1px solid var(--border);margin-bottom:10px;font-family:'Space Grotesk',sans-serif;}
.pstats-wrapper{margin-top:16px;}
.pstats-title{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-bottom:8px;color:var(--muted);}
table.ptable{width:100%;border-collapse:collapse;}
table.ptable th{font-size:9px;color:var(--muted);font-weight:700;text-align:center;padding:4px 6px;text-transform:uppercase;letter-spacing:0.5px;}
table.ptable th:first-child{text-align:left;}
table.ptable td{font-size:11px;text-align:center;padding:6px 6px;border-bottom:1px solid rgba(30,39,48,0.4);}
table.ptable td:first-child{text-align:left;}
table.ptable tbody tr:last-child td{border-bottom:none;}
table.ptable tbody tr:hover{background:var(--card);}
.p-name{font-weight:600;}
.p-pos{font-size:9px;color:var(--muted);margin-left:4px;}
.p-rating{font-weight:700;font-size:12px;border-radius:4px;padding:2px 6px;display:inline-block;}
.p-captain{font-size:9px;color:var(--yellow);margin-left:3px;}

/* LINEUP */
.pitch-wrapper{padding:14px;}
.pitch{background:linear-gradient(180deg,#0a1f0a 0%,#0d2a0d 50%,#0a1f0a 100%);border:1px solid #1a3a1a;border-radius:10px;aspect-ratio:3/4;position:relative;overflow:hidden;max-width:340px;margin:0 auto;}
.pitch-lines{position:absolute;inset:0;pointer-events:none;}
.pitch-circle{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:28%;padding-bottom:28%;border:1px solid rgba(255,255,255,0.1);border-radius:50%;}
.pitch-line-h{position:absolute;top:50%;left:5%;right:5%;height:1px;background:rgba(255,255,255,0.1);}
.pitch-box-h{position:absolute;top:5%;left:20%;right:20%;height:16%;border:1px solid rgba(255,255,255,0.1);}
.pitch-box-a{position:absolute;bottom:5%;left:20%;right:20%;height:16%;border:1px solid rgba(255,255,255,0.1);}
.player-dot{position:absolute;transform:translate(-50%,-50%);display:flex;flex-direction:column;align-items:center;gap:2px;cursor:pointer;}
.player-dot:hover .pd-badge{transform:scale(1.15);}
.pd-badge{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:8px;font-weight:800;color:#fff;font-family:'Space Grotesk',sans-serif;transition:transform 0.15s;border:2px solid rgba(255,255,255,0.2);}
.pd-name{font-size:8px;font-weight:600;color:#fff;white-space:nowrap;background:rgba(0,0,0,0.7);padding:1px 4px;border-radius:3px;max-width:60px;overflow:hidden;text-overflow:ellipsis;}
.lineup-header{display:flex;justify-content:space-between;margin-bottom:10px;font-size:11px;font-weight:700;color:var(--muted);}

/* EVENTS / TIMELINE */
.events-wrapper{padding:14px;}
.timeline{display:flex;flex-direction:column;gap:0;}
.tl-item{display:grid;grid-template-columns:1fr 44px 1fr;gap:4px;align-items:center;}
.tl-home,.tl-away{padding:4px 0;}
.tl-minute{text-align:center;font-family:'Space Grotesk',sans-serif;font-size:11px;font-weight:700;color:var(--muted);position:relative;}
.tl-minute::before{content:'';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:8px;height:8px;border-radius:50%;background:var(--border);}
.tl-minute.goal::before{background:var(--accent);}
.tl-minute.yellow-card::before{background:var(--yellow);}
.tl-minute.red-card::before{background:var(--red);}
.tl-minute.sub::before{background:var(--blue);}
.tl-event{background:var(--surface);border:1px solid var(--border);border-radius:7px;padding:6px 8px;}
.tl-away .tl-event{text-align:right;}
.tl-event-icon{font-size:13px;}
.tl-event-player{font-size:11px;font-weight:600;}
.tl-event-sub-out{font-size:10px;color:var(--muted);}
.tl-event-type{font-size:10px;color:var(--muted);}
.tl-period-marker{display:flex;align-items:center;gap:8px;padding:8px 0;}
.tl-period-line{flex:1;height:1px;background:var(--border);}
.tl-period-label{font-size:10px;font-weight:700;color:var(--muted);letter-spacing:1px;white-space:nowrap;text-transform:uppercase;}

/* TEAM HISTORY PANEL */
.team-history-overlay{position:fixed;inset:0;z-index:1100;background:rgba(0,0,0,0.8);backdrop-filter:blur(8px);display:flex;justify-content:flex-end;opacity:0;pointer-events:none;transition:opacity 0.25s;}
.team-history-overlay.open{opacity:1;pointer-events:all;}
.team-history-panel{width:min(480px,100vw);background:var(--bg);border-left:1px solid var(--border);display:flex;flex-direction:column;transform:translateX(100%);transition:transform 0.35s cubic-bezier(0.22,1,0.36,1);}
.team-history-overlay.open .team-history-panel{transform:translateX(0);}
.th-header{padding:18px 20px;border-bottom:1px solid var(--border);background:var(--surface);display:flex;align-items:center;gap:12px;position:relative;}
.th-badge{width:44px;height:44px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:800;color:#fff;flex-shrink:0;font-family:'Space Grotesk',sans-serif;}
.th-team-name{font-family:'Space Grotesk',sans-serif;font-size:16px;font-weight:700;}
.th-league{font-size:11px;color:var(--muted);}
.th-close{position:absolute;top:14px;right:14px;width:28px;height:28px;border-radius:50%;background:rgba(255,255,255,0.06);border:1px solid var(--border);color:var(--text2);cursor:pointer;font-size:13px;display:flex;align-items:center;justify-content:center;}
.th-close:hover{background:rgba(255,255,255,0.12);}
.th-body{flex:1;overflow-y:auto;padding:14px;}
.th-section-title{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--muted);margin-bottom:8px;padding:6px 0;border-bottom:1px solid var(--border);font-family:'Space Grotesk',sans-serif;}
.th-match{display:flex;align-items:center;gap:10px;padding:9px 10px;border-radius:8px;cursor:pointer;transition:background 0.12s;border-bottom:1px solid rgba(30,39,48,0.5);}
.th-match:hover{background:var(--surface);}
.th-match:last-child{border-bottom:none;}
.th-result{width:24px;height:24px;border-radius:5px;font-size:10px;font-weight:700;display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.th-r-W{background:#2ea043;color:#fff;}
.th-r-D{background:rgba(68,138,255,0.4);color:var(--blue);}
.th-r-L{background:rgba(255,61,87,0.3);color:var(--red);}
.th-opp{flex:1;font-size:12px;font-weight:600;}
.th-score{font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:700;}
.th-comp{font-size:10px;color:var(--muted);}
.th-date{font-size:10px;color:var(--muted);}
.th-stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:14px;}
.th-stat-card{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:10px;text-align:center;}
.th-stat-val{font-family:'Space Grotesk',sans-serif;font-size:20px;font-weight:700;}
.th-stat-label{font-size:10px;color:var(--muted);margin-top:2px;}

/* MISC */
.loading-overlay{display:flex;flex-direction:column;align-items:center;justify-content:center;height:300px;gap:14px;}
.spinner{width:36px;height:36px;border-radius:50%;border:3px solid var(--border);border-top-color:var(--accent);animation:spin 0.7s linear infinite;}
.loading-text{font-size:11px;color:var(--muted);letter-spacing:1px;}
.empty-state{padding:50px;text-align:center;color:var(--muted);font-size:12px;}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px);}to{opacity:1;transform:translateY(0);}}
.fade-up{animation:fadeUp 0.3s ease both;}
</style>
</head>
<body>

<!-- HEADER -->
<header class="header">
  <div class="header-inner">
    <a class="logo" href="#">
      <svg class="logo-icon" viewBox="0 0 40 44" fill="none" xmlns="http://www.w3.org/2000/svg">
        <defs>
          <linearGradient id="shieldGrad" x1="0" y1="0" x2="0" y2="1">
            <stop offset="0%" stop-color="#1a2e1a"/>
            <stop offset="100%" stop-color="#0a1210"/>
          </linearGradient>
          <linearGradient id="boltGrad" x1="0" y1="0" x2="0.5" y2="1">
            <stop offset="0%" stop-color="#00e676"/>
            <stop offset="100%" stop-color="#00c853"/>
          </linearGradient>
          <filter id="boltGlow" x="-40%" y="-40%" width="180%" height="180%">
            <feGaussianBlur stdDeviation="1.5" result="blur"/>
            <feMerge><feMergeNode in="blur"/><feMergeNode in="SourceGraphic"/></feMerge>
          </filter>
        </defs>
        <!-- Shield body -->
        <path d="M20 2 L38 8 L38 22 C38 32 20 42 20 42 C20 42 2 32 2 22 L2 8 Z" fill="url(#shieldGrad)" stroke="#00e676" stroke-width="1.2" stroke-linejoin="round"/>
        <!-- Inner shield border -->
        <path d="M20 6 L34 11 L34 22 C34 30 20 38 20 38 C20 38 6 30 6 22 L6 11 Z" fill="none" stroke="rgba(0,230,118,0.15)" stroke-width="0.8"/>
        <!-- Lightning bolt -->
        <path d="M23 8 L14 22 L20.5 22 L17 36 L27 20 L20.5 20 Z" fill="url(#boltGrad)" filter="url(#boltGlow)"/>
      </svg>
      <span class="logo-text">LIVE<em>STATS</em><div class="logo-live-dot"></div></span>
    </a>
    <div class="header-right">
      <div class="live-indicator"><div class="live-dot"></div><span>Auto-refresh in <strong id="countdown">60</strong>s</span></div>
      <button class="btn-refresh" id="btn-refresh" onclick="refreshAll()">‚Üª Refresh</button>
    </div>
  </div>
  <div class="nav-row">
    <div class="nav-tabs">
      <button class="nav-tab active" onclick="switchMainTab('scores',this)"><div class="tab-dot"></div>Scores</button>
      <button class="nav-tab" onclick="switchMainTab('standings',this)">Standings</button>
      <button class="nav-tab" onclick="switchMainTab('news',this)">News<span class="tab-badge" id="news-badge" style="display:none">NEW</span></button>
    </div>
  </div>
</header>

<!-- LAYOUT -->
<div class="layout">
  <!-- SIDEBAR -->
  <nav class="sidebar">
    <div class="sidebar-section">
      <div class="sidebar-label">Leagues</div>
      <div class="sidebar-item active" onclick="filterLeague('all',this)">
        <span class="s-flag">üåç</span><span class="s-name">All Leagues</span>
      </div>
      <div class="sidebar-item" onclick="filterLeague('epl',this)">
        <span class="s-flag">üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø</span><span class="s-name">Premier League</span><span class="s-count">20</span>
      </div>
      <div class="sidebar-item" onclick="filterLeague('la_liga',this)">
        <span class="s-flag">üá™üá∏</span><span class="s-name">La Liga</span><span class="s-count">16</span>
      </div>
      <div class="sidebar-item" onclick="filterLeague('bundesliga',this)">
        <span class="s-flag">üá©üá™</span><span class="s-name">Bundesliga</span><span class="s-count">12</span>
      </div>
      <div class="sidebar-item" onclick="filterLeague('serie_a',this)">
        <span class="s-flag">üáÆüáπ</span><span class="s-name">Serie A</span><span class="s-count">12</span>
      </div>
      <div class="sidebar-item" onclick="filterLeague('champions_league',this)">
        <span class="s-flag">‚≠ê</span><span class="s-name">Champions League</span><span class="s-count">10</span>
      </div>
    </div>
  </nav>

  <!-- MAIN -->
  <div class="main">

    <!-- SCORES PANEL -->
    <div id="panel-scores">
      <div class="date-bar">
        <button class="date-btn active" onclick="setDateFilter('all',this)">All</button>
        <button class="date-btn live-now-btn" onclick="setDateFilter('live',this)"><span style="display:inline-block;width:6px;height:6px;border-radius:50%;background:var(--live);margin-right:5px;animation:blink 1s infinite;vertical-align:middle"></span>Live Now</button>
        <button class="date-btn" onclick="setDateFilter('past',this)">Completed</button>
        <button class="date-btn" onclick="setDateFilter('upcoming',this)">Upcoming</button>
      </div>
      <div id="scores-content"><div class="loading-overlay"><div class="spinner"></div><div class="loading-text">Loading matches...</div></div></div>
    </div>

    <!-- STANDINGS PANEL -->
    <div id="panel-standings" style="display:none">
      <div id="std-league-tabs-wrap">
        <!-- league tabs rendered here -->
      </div>
      <div id="standings-content"><div class="loading-overlay"><div class="spinner"></div><div class="loading-text">Loading standings...</div></div></div>
    </div>

    <!-- NEWS PANEL -->
    <div id="panel-news" style="display:none">
      <div class="news-header">
        <div class="news-header-left">
          <span class="news-title">Football News</span>
          <div class="news-live-badge"><div class="live-dot"></div>Live Updates</div>
        </div>
        <div class="news-filter">
          <button class="news-cat-btn active" onclick="filterNews('all',this)">All</button>
          <button class="news-cat-btn" onclick="filterNews('transfers',this)">Transfers</button>
          <button class="news-cat-btn" onclick="filterNews('results',this)">Results</button>
          <button class="news-cat-btn" onclick="filterNews('rumours',this)">Rumours</button>
        </div>
      </div>
      <div id="news-content"><div class="news-loading"><div class="news-spinner"></div><div>Fetching latest football news...</div></div></div>
    </div>

  </div>
</div>

<!-- NEWS ARTICLE OVERLAY -->
<div class="news-article-overlay" id="newsArticleOverlay" onclick="handleNAClick(event)">
  <div class="na-backdrop"></div>
  <div class="na-panel" id="naPanel">
    <div class="na-hero" id="na-hero">
      <div class="na-hero-img" id="na-hero-img"></div>
      <div class="na-hero-overlay"></div>
      <button class="na-close" onclick="closeNewsArticle()">‚úï</button>
    </div>
    <div class="na-body" id="na-body"></div>
  </div>
</div>

<!-- MATCH DETAIL MODAL -->
<div class="modal-overlay" id="matchModal" onclick="handleModalClick(event)">
  <div class="modal-backdrop"></div>
  <div class="modal-panel" id="matchModalPanel">
    <div id="modal-inner"></div>
    <div class="modal-tabs" id="modal-tabs-bar"></div>
    <div class="modal-body" id="modal-body"></div>
  </div>
</div>

<!-- TEAM HISTORY PANEL -->
<div class="team-history-overlay" id="teamHistoryOverlay" onclick="handleTHClick(event)">
  <div class="team-history-panel" id="teamHistoryPanel">
    <div id="th-inner"></div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ CONFIG ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// ESPN public API ‚Äî no key needed, CORS open, works from any browser
const API_BASE = 'https://site.api.espn.com';

const LEAGUE_CONFIG = {
  epl:              { slug: 'eng.1',         name: 'Premier League',   flag: 'üè¥Û†ÅßÛ†Å¢Û†Å•Û†ÅÆÛ†ÅßÛ†Åø', country: 'England' },
  champions_league: { slug: 'uefa.champions', name: 'Champions League', flag: '‚≠ê',  country: 'Europe'  },
  bundesliga:       { slug: 'ger.1',          name: 'Bundesliga',       flag: 'üá©üá™', country: 'Germany' },
  serie_a:          { slug: 'ita.1',          name: 'Serie A',          flag: 'üáÆüáπ', country: 'Italy'   },
  la_liga:          { slug: 'esp.1',          name: 'La Liga',          flag: 'üá™üá∏', country: 'Spain'   },
  ligue_1:          { slug: 'fra.1',          name: 'Ligue 1',          flag: 'üá´üá∑', country: 'France'  },
};

// ‚îÄ‚îÄ‚îÄ COLORS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const TEAM_COLORS = {
  'Arsenal':'#EF0107','Manchester City':'#6CABDD','Liverpool':'#C8102E',
  'Manchester United':'#DA291C','Tottenham Hotspur':'#132257','Chelsea':'#034694',
  'Aston Villa':'#95BFE5','Brighton & Hove Albion':'#0057B8','West Ham United':'#7A263A',
  'Everton':'#003399','Newcastle United':'#241F20','Brentford':'#E30613',
  'Bournemouth':'#DA291C','Fulham':'#CC0000','Crystal Palace':'#1B458F',
  'Nottingham Forest':'#DD0000','Ipswich Town':'#0044AA','Leicester City':'#003090',
  'Southampton':'#D71920','Wolverhampton Wanderers':'#FDB913','Wolves':'#FDB913',
  'Barcelona':'#A50044','Real Madrid':'#FEBE10','Atletico Madrid':'#CB3524',
  'Villarreal':'#005C97','Real Sociedad':'#00529F','Real Betis':'#00954C',
  'Sevilla':'#D4141C','Getafe':'#005F9E','Osasuna':'#B03060',
  'Athletic Club':'#CC0000','Alaves':'#00549F','Rayo Vallecano':'#CC0000',
  'Girona':'#B31B1B','Mallorca':'#E4002B','Valencia':'#EE7C0E',
  'Celta Vigo':'#87CEEB','Espanyol':'#0070B8','Las Palmas':'#FFD700','Valladolid':'#8B1C62',
  'Bayern Munich':'#DC052D','Borussia Dortmund':'#FDE100','Bayer Leverkusen':'#E32221',
  'Eintracht Frankfurt':'#E1000F','Wolfsburg':'#65B32E','Augsburg':'#BA3733',
  'Union Berlin':'#EB1923','FC K√∂ln':'#FC3B36','RB Leipzig':'#DD0741',
  'Freiburg':'#E00034','Stuttgart':'#E32219','Mainz 05':'#C3161C',
  "Borussia M'gladbach":'#000000','TSG Hoffenheim':'#1661A6',
  'Werder Bremen':'#1D9045','FC St. Pauli':'#6B0F1A','Holstein Kiel':'#CC0000',
  'Heidenheim':'#E30613',
  'Internazionale':'#010E80','AC Milan':'#FB090B','Napoli':'#087AC0',
  'Juventus':'#000000','Roma':'#8B0000','Atalanta':'#1B78C8',
  'Lazio':'#87CEEB','Fiorentina':'#8B1921','Torino':'#8B0000',
  'Cagliari':'#DD0000','Genoa':'#E32119','Hellas Verona':'#FFD700',
  'Bologna':'#CC0000','Udinese':'#000000','Empoli':'#0057B8',
  'Lecce':'#FFD700','Parma':'#FFFF00','Como':'#003087','Venezia':'#003087','Monza':'#CC0000',
  'Paris Saint-Germain':'#004170','Monaco':'#ED1C24','Marseille':'#1A86CA',
  'Lyon':'#CC0000','Lille':'#E31E24','Nice':'#CC0000',
  'Lens':'#E30613','Rennes':'#CC0000','Montpellier':'#0057B8',
  'Nantes':'#FFD700','Brest':'#CC0000','Strasbourg':'#0038A8',
  'Toulouse':'#8B1921','Le Havre':'#0057B8','Angers':'#000000',
  'Saint-√âtienne':'#008000','Auxerre':'#003087',
};
function getColor(name) {
  if (!name) return '#445566';
  if (TEAM_COLORS[name]) return TEAM_COLORS[name];
  // Fuzzy match ‚Äî strip suffixes ESPN adds or doesn't add
  const clean = name.replace(/\s?(FC|CF|AC|AFC|SC|United|City|Athletic)$/,'').trim();
  for (const [k,v] of Object.entries(TEAM_COLORS)) {
    if (k.includes(clean) || clean.includes(k.split(' ')[0])) return v;
  }
  return '#445566';
}
function getAbbr(name) {
  if (!name) return '???';
  const skip = ['FC','AFC','SC','AC','AS','CF','CD','RC','SSC','SV','VfL','VfB','FSV','TSG','RB','OGC','LOSC','HSC','GC'];
  const words = name.replace(/[()]/g,'').split(' ').filter(w => !skip.includes(w) && w.length > 0);
  if (words.length >= 2) return (words[0][0] + words[1][0] + (words[2]?.[0] || words[1][1] || '')).toUpperCase().slice(0,3);
  return words[0].slice(0,3).toUpperCase();
}

// ‚îÄ‚îÄ‚îÄ API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const apiCache = {};
async function apiFetch(path) {
  if (apiCache[path]) return apiCache[path];
  const res = await fetch(API_BASE + path);
  if (!res.ok) throw new Error(`HTTP ${res.status}`);
  const data = await res.json();
  apiCache[path] = data;
  return data;
}

function formatDate(d) { return d.toISOString().split('T')[0]; }
function formatDateESPN(d) {
  const y = d.getFullYear();
  const m = String(d.getMonth()+1).padStart(2,'0');
  const day = String(d.getDate()).padStart(2,'0');
  return `${y}${m}${day}`;
}

// ‚îÄ‚îÄ‚îÄ STATUS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function mapStatus(typeName) {
  if (['STATUS_IN_PROGRESS','STATUS_HALFTIME','STATUS_END_PERIOD','STATUS_FIRST_HALF',
       'STATUS_SECOND_HALF','STATUS_OVERTIME','STATUS_PENALTY'].includes(typeName)) return 'LIVE';
  if (['STATUS_FINAL','STATUS_FULL_TIME','STATUS_FULL_PEN','STATUS_FT'].includes(typeName)) return 'FT';
  return 'SCH';
}

// ‚îÄ‚îÄ‚îÄ TRANSFORM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function transformMatch(event) {
  const comp   = event.competitions?.[0];
  if (!comp) return null;
  const home   = comp.competitors?.find(c => c.homeAway === 'home') || comp.competitors?.[0];
  const away   = comp.competitors?.find(c => c.homeAway === 'away') || comp.competitors?.[1];
  if (!home || !away) return null;

  const statusName = event.status?.type?.name || 'STATUS_SCHEDULED';
  const status = mapStatus(statusName);

  const kickoff = new Date(event.date);
  const timeStr = kickoff.toLocaleTimeString('en-GB', { hour:'2-digit', minute:'2-digit', timeZone:'Europe/London' });
  const dateStr = kickoff.toLocaleDateString('en-GB', { day:'numeric', month:'short' });

  // Scores ‚Äî only valid for live/FT
  const hs  = status !== 'SCH' ? (parseInt(home.score) ?? null) : null;
  const as_ = status !== 'SCH' ? (parseInt(away.score) ?? null) : null;

  // Live elapsed minute from ESPN's displayClock ("45:00" ‚Üí 45)
  let elapsed = null;
  if (status === 'LIVE') {
    const clock = event.status?.displayClock || '';
    const parts = clock.split(':');
    elapsed = parts.length > 0 ? parseInt(parts[0]) || null : null;
  }

  // Halftime scores from linescores if available
  const hLines = home.linescores || [];
  const aLines = away.linescores || [];
  const halftimeH = hLines[0]?.value != null ? parseInt(hLines[0].value) : null;
  const halftimeA = aLines[0]?.value != null ? parseInt(aLines[0].value) : null;

  // ESPN provides team hex colors directly ‚Äî use those, fallback to our lookup
  const hColor = home.team?.color ? '#' + home.team.color : getColor(home.team?.displayName);
  const aColor = away.team?.color ? '#' + away.team.color : getColor(away.team?.displayName);

  return {
    home:      home.team?.displayName || home.team?.name || 'Home',
    hA:        home.team?.abbreviation || getAbbr(home.team?.displayName || ''),
    hId:       home.team?.id,
    hColor,
    away:      away.team?.displayName || away.team?.name || 'Away',
    aA:        away.team?.abbreviation || getAbbr(away.team?.displayName || ''),
    aId:       away.team?.id,
    aColor,
    hs,
    as:        as_,
    status,
    statusRaw: statusName,
    elapsed,
    time:      timeStr,
    date:      dateStr,
    kickoffTs: event.date,
    matchId:   event.id,
    venue:     comp.venue?.fullName || '',
    referee:   comp.officials?.[0]?.fullName || '',
    halftimeH,
    halftimeA,
  };
}

function sortMatches(games) {
  const ord = { LIVE:0, SCH:1, FT:2 };
  return games.filter(Boolean).sort((a,b) => {
    if (ord[a.status] !== ord[b.status]) return ord[a.status] - ord[b.status];
    if (a.status === 'FT') return new Date(b.kickoffTs) - new Date(a.kickoffTs);
    return new Date(a.kickoffTs) - new Date(b.kickoffTs);
  });
}

// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let LEAGUES        = {};
let activeLeague   = 'all';
let dateFilter     = 'all';
let mainTab        = 'scores';
let countdown      = 60;
let countdownTimer = null;
let activeModalTab = 'overview';
let currentModalGame = null;
let stdActiveLeague  = 'epl';
let newsCategory   = 'all';
let newsLoaded     = false;
let allNews        = [];
let dataLoaded     = false;

// ‚îÄ‚îÄ‚îÄ LIVE MINUTE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getLiveMinute(g) {
  if (g.elapsed != null) return g.elapsed + "'";
  if (g.kickoffTs) {
    const el = Math.min(90, Math.max(1, Math.floor((Date.now() - new Date(g.kickoffTs).getTime()) / 60000)));
    return el + "'";
  }
  return 'LIVE';
}
setInterval(() => {
  document.querySelectorAll('.m-live-clock').forEach(el => {
    const kickoff = el.dataset.kickoff;
    if (!kickoff) return;
    const elapsed = Math.min(90, Math.max(1, Math.floor((Date.now() - new Date(kickoff).getTime()) / 60000)));
    el.textContent = elapsed + "'";
  });
}, 30000);

// ‚îÄ‚îÄ‚îÄ LOAD DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function loadFixtures() {
  const today = new Date();
  const from  = formatDateESPN(new Date(today.getTime() - 3  * 86400000));
  const to    = formatDateESPN(new Date(today.getTime() + 10 * 86400000));

  document.getElementById('scores-content').innerHTML =
    '<div class="loading-overlay"><div class="spinner"></div><div class="loading-text">Fetching live data...</div></div>';

  let anyError = null;

  for (const [lk, cfg] of Object.entries(LEAGUE_CONFIG)) {
    try {
      const data = await apiFetch(`/apis/site/v2/sports/soccer/${cfg.slug}/scoreboard?dates=${from}-${to}&limit=100`);
      const games = sortMatches((data.events || []).map(transformMatch));
      LEAGUES[lk] = { name: cfg.name, flag: cfg.flag, country: cfg.country, games, standings: null };
    } catch(e) {
      anyError = e.message;
      console.warn(`Failed to load ${lk}:`, e.message);
      LEAGUES[lk] = { name: cfg.name, flag: cfg.flag, country: cfg.country, games: [], standings: null };
    }
  }

  dataLoaded = true;
  const total = Object.values(LEAGUES).reduce((s,L) => s + L.games.length, 0);

  if (total === 0 && anyError) {
    document.getElementById('scores-content').innerHTML = `
      <div class="empty-state" style="padding:50px 30px;text-align:center">
        <div style="font-size:32px;margin-bottom:14px">‚ö†Ô∏è</div>
        <div style="font-size:14px;font-weight:700;color:var(--red);margin-bottom:10px">Connection Failed</div>
        <div style="font-size:12px;color:var(--muted);max-width:360px;margin:0 auto;line-height:1.7;background:var(--card);border:1px solid var(--border);border-radius:8px;padding:12px">${anyError}</div>
        <button onclick="refreshAll()" style="margin-top:16px;background:var(--accent-dim);border:1px solid rgba(0,230,118,0.3);color:var(--accent);padding:8px 20px;border-radius:8px;cursor:pointer;font-size:12px;font-family:'DM Sans',sans-serif">‚Üª Try Again</button>
      </div>`;
    return;
  }

  updateSidebarCounts();
  renderScores();
}

function updateSidebarCounts() {
  Object.entries(LEAGUES).forEach(([lk, L]) => {
    document.querySelectorAll('.sidebar-item').forEach(item => {
      const oc = item.getAttribute('onclick') || '';
      if (oc.includes(`'${lk}'`)) {
        const badge = item.querySelector('.s-count');
        if (badge) badge.textContent = L.games.length;
      }
    });
  });
}

// ‚îÄ‚îÄ‚îÄ RENDER SCORES ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderScores() {
  if (!dataLoaded) return;
  let html = '';
  const keys = activeLeague === 'all' ? Object.keys(LEAGUES) : [activeLeague];
  keys.forEach(lk => {
    const L = LEAGUES[lk];
    if (!L) return;
    let games = [...L.games];
    if (dateFilter === 'past')       games = games.filter(g => g.status === 'FT');
    else if (dateFilter === 'upcoming') games = games.filter(g => g.status === 'SCH');
    else if (dateFilter === 'live')     games = games.filter(g => g.status === 'LIVE');
    if (!games.length) return;

    html += `<div class="league-block fade-up">
      <div class="league-header" onclick="toggleLeague(this)">
        <span class="l-flag">${L.flag}</span>
        <span class="l-name">${L.name}</span>
        <span class="l-sub">${L.country}</span>
        <span class="l-count">${games.length} matches</span>
        <span class="l-toggle">‚ñæ</span>
      </div><div class="league-games">`;

    games.forEach(g => {
      const ri     = L.games.indexOf(g);
      const isLive = g.status === 'LIVE';
      const isFT   = g.status === 'FT';
      const isSCH  = g.status === 'SCH';
      const hWin   = isFT && g.hs > g.as;
      const aWin   = isFT && g.as > g.hs;
      const hc = g.hColor || getColor(g.home);
      const ac = g.aColor || getColor(g.away);
      html += `<div class="match-row ${isLive ? 'live-match' : ''}" onclick="openMatchDetail('${lk}',${ri})">
        <div class="m-time">
          ${isLive ? `<div class="m-live"><div class="m-live-dot"></div>LIVE</div>
            <div class="m-live-clock" data-kickoff="${g.kickoffTs}">${getLiveMinute(g)}</div>` : ''}
          ${isFT  ? `<div class="m-ft">FT</div><div class="m-date">${g.date}</div>` : ''}
          ${isSCH ? `<div class="m-sch-time">${g.time}</div><div class="m-date">${g.date}</div>` : ''}
        </div>
        <div class="team-col">
          <div class="team-badge" style="background:${hc}">${g.hA.slice(0,3)}</div>
          <span class="team-name ${hWin?'winner':''}">${g.home}</span>
        </div>
        <div class="score-col">
          ${isSCH ? `<div class="score-vs">vs</div>` :
            `<div class="score-nums ${isLive?'live-c':''}">
              <span>${g.hs !== null ? g.hs : (isLive ? '?' : '‚Äì')}</span><span class="s-dash">‚Äì</span><span>${g.as !== null ? g.as : (isLive ? '?' : '‚Äì')}</span>
            </div>`}
        </div>
        <div class="team-col away">
          <div class="team-badge" style="background:${ac}">${g.aA.slice(0,3)}</div>
          <span class="team-name ${aWin?'winner':''}">${g.away}</span>
        </div>
        <div style="text-align:right">
          ${isLive ? `<span class="m-tag tag-live">‚óè LIVE</span>` : ''}
          ${isFT   ? `<span class="m-tag tag-ft">Full Time</span>` : ''}
          ${isSCH  ? `<span class="m-tag tag-sch">Upcoming</span>` : ''}
        </div>
      </div>`;
    });
    html += `</div></div>`;
  });

  document.getElementById('scores-content').innerHTML = html ||
    `<div class="empty-state">${dateFilter === 'live'
      ? '<div style="font-size:28px;margin-bottom:12px">üì°</div><div style="font-size:13px;font-weight:600;color:var(--text2);margin-bottom:6px">No games live right now</div><div style="font-size:11px;color:var(--muted)">Check back soon ‚Äî live games will appear here automatically</div>'
      : 'No matches found.'}</div>`;
}

function toggleLeague(el) { el.closest('.league-block').classList.toggle('collapsed'); }

// ‚îÄ‚îÄ‚îÄ STANDINGS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderStandingsTabs() {
  let html = `<div class="std-league-tabs">`;
  Object.entries(LEAGUE_CONFIG).forEach(([lk, cfg]) => {
    if (lk === 'champions_league') return;
    html += `<button class="std-league-tab ${stdActiveLeague === lk ? 'active' : ''}" onclick="switchStdLeague('${lk}',this)">${cfg.flag} ${cfg.name}</button>`;
  });
  html += `</div>`;
  document.getElementById('std-league-tabs-wrap').innerHTML = html;
}

async function loadStandings(lk) {
  if (LEAGUES[lk]?.standings) return;
  const cfg = LEAGUE_CONFIG[lk];
  if (!cfg || lk === 'champions_league') return;
  try {
    const data = await apiFetch(`/apis/v2/sports/soccer/${cfg.slug}/standings`);
    // ESPN standings can be nested under children for grouped leagues
    const entries = data.standings?.entries
      || data.children?.[0]?.standings?.entries
      || [];
    if (!LEAGUES[lk]) LEAGUES[lk] = { name: cfg.name, flag: cfg.flag, country: cfg.country, games: [], standings: null };
    const getStat = (stats, name) => stats?.find(s => s.name === name)?.value ?? 0;
    LEAGUES[lk].standings = entries.map((e, i) => {
      const stats = e.stats || [];
      return {
        r:    getStat(stats,'rank') || i + 1,
        team: e.team?.displayName || e.team?.name || '',
        abbr: e.team?.abbreviation || getAbbr(e.team?.displayName || ''),
        w:    getStat(stats,'wins'),
        d:    getStat(stats,'ties'),
        l:    getStat(stats,'losses'),
        gf:   getStat(stats,'pointsFor'),
        ga:   getStat(stats,'pointsAgainst'),
        pts:  getStat(stats,'points'),
        form: [],
      };
    });
  } catch(e) { console.error('Standings error', lk, e.message); }
}

function switchStdLeague(lk, el) {
  stdActiveLeague = lk;
  document.querySelectorAll('.std-league-tab').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  renderStandingsTable();
}

async function renderStandings() {
  renderStandingsTabs();
  document.getElementById('standings-content').innerHTML =
    '<div class="loading-overlay"><div class="spinner"></div><div class="loading-text">Loading standings...</div></div>';
  await loadStandings(stdActiveLeague);
  renderStandingsTable();
}

function renderStandingsTable() {
  const lk = stdActiveLeague;
  const L  = LEAGUES[lk];
  if (!L?.standings) {
    document.getElementById('standings-content').innerHTML =
      '<div class="loading-overlay"><div class="spinner"></div><div class="loading-text">Fetching standings...</div></div>';
    loadStandings(lk).then(renderStandingsTable);
    return;
  }
  const total = L.standings.length;
  let html = `<div class="standings-wrapper">
    <div class="zone-legend">
      <div class="zl-item"><div class="zl-box" style="background:var(--accent)"></div>Champions League</div>
      <div class="zl-item"><div class="zl-box" style="background:var(--blue)"></div>Europa League</div>
      <div class="zl-item"><div class="zl-box" style="background:var(--red)"></div>Relegation</div>
    </div>
    <div class="standings-table-wrap"><table class="stable">
    <thead><tr><th>#</th><th>Club</th><th>P</th><th>W</th><th>D</th><th>L</th><th>GF</th><th>GA</th><th>GD</th><th>Pts</th></tr></thead>
    <tbody>`;
  L.standings.forEach(s => {
    const gd = s.gf - s.ga;
    const played = s.w + s.d + s.l;
    let zone = '';
    if (s.r <= 4) zone = 'zone-cl';
    else if (s.r <= 6) zone = 'zone-el';
    else if (s.r >= total - 2) zone = 'zone-rel';
    const rCls = s.r <= 3 ? `rank-${s.r}` : '';
    const clr = getColor(s.team);
    html += `<tr class="${zone}" onclick="openTeamHistory('${lk}','${s.abbr}','${s.team}')">
      <td><span class="rank-num ${rCls}">${s.r}</span></td>
      <td><div class="team-cell-std"><div class="t-badge" style="background:${clr}">${s.abbr.slice(0,3)}</div><span class="t-name-std">${s.team}</span></div></td>
      <td>${played}</td><td>${s.w}</td><td>${s.d}</td><td>${s.l}</td>
      <td>${s.gf}</td><td>${s.ga}</td>
      <td style="color:${gd>0?'var(--accent)':gd<0?'var(--red)':'var(--muted)'}">${gd>0?'+':''}${gd}</td>
      <td class="pts-cell">${s.pts}</td>
    </tr>`;
  });
  html += `</tbody></table></div></div>`;
  document.getElementById('standings-content').innerHTML = html;
}

// ‚îÄ‚îÄ‚îÄ TEAM HISTORY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function openTeamHistory(leagueKey, abbr, teamName) {
  const L = LEAGUES[leagueKey];
  if (!L) return;
  const clr = getColor(teamName);
  const matches = [];
  Object.entries(LEAGUES).forEach(([lk, LG]) => {
    LG.games.forEach((g, gi) => {
      const isHome = g.hA === abbr || g.home === teamName;
      const isAway = g.aA === abbr || g.away === teamName;
      if (!isHome && !isAway) return;
      const myScore    = isHome ? g.hs : g.as;
      const theirScore = isHome ? g.as : g.hs;
      let result = 'D';
      if (g.status === 'FT') {
        if (myScore > theirScore) result = 'W';
        else if (myScore < theirScore) result = 'L';
      }
      matches.push({ lk, gi, g, isHome, opp: isHome ? g.away : g.home, result, myScore, theirScore, leagueName: LG.name });
    });
  });
  const finished = matches.filter(m => m.g.status === 'FT').slice(-8);
  const upcoming = matches.filter(m => m.g.status === 'SCH').slice(0, 5);
  const standing = L.standings?.find(s => s.team === teamName || s.abbr === abbr) || null;

  let html = `<div class="th-header">
    <div class="th-badge" style="background:${clr}">${abbr.slice(0,3)}</div>
    <div><div class="th-team-name">${teamName}</div><div class="th-league">${L.name}</div></div>
    <button class="th-close" onclick="closeTeamHistory()">‚úï</button>
  </div><div class="th-body">`;

  if (standing) {
    html += `<div class="th-section-title">Current Standing</div>
      <div class="th-stats-grid">
        <div class="th-stat-card"><div class="th-stat-val" style="color:var(--accent)">${standing.pts}</div><div class="th-stat-label">Points</div></div>
        <div class="th-stat-card"><div class="th-stat-val">${standing.r}</div><div class="th-stat-label">Position</div></div>
        <div class="th-stat-card"><div class="th-stat-val" style="color:var(--accent)">${standing.gf}</div><div class="th-stat-label">Goals For</div></div>
        <div class="th-stat-card"><div class="th-stat-val" style="color:var(--red)">${standing.ga}</div><div class="th-stat-label">Goals Against</div></div>
      </div>`;
  }
  if (finished.length) {
    html += `<div class="th-section-title">Recent Matches</div>`;
    [...finished].reverse().forEach(m => {
      html += `<div class="th-match" onclick="openMatchDetail('${m.lk}',${m.gi})">
        <div class="th-result th-r-${m.result}">${m.result}</div>
        <div><div class="th-opp">${m.isHome ? 'vs' : '@'} ${m.opp}</div><div class="th-comp">${m.leagueName}</div></div>
        <div style="text-align:right">
          <div class="th-score">${m.myScore ?? '‚Äì'} ‚Äì ${m.theirScore ?? '‚Äì'}</div>
          <div class="th-date">${m.g.date || ''}</div>
        </div>
      </div>`;
    });
  }
  if (upcoming.length) {
    html += `<div class="th-section-title" style="margin-top:14px">Upcoming Fixtures</div>`;
    upcoming.forEach(m => {
      html += `<div class="th-match" onclick="openMatchDetail('${m.lk}',${m.gi})">
        <div class="th-result" style="background:var(--border);color:var(--muted)">‚Äì</div>
        <div><div class="th-opp">${m.isHome ? 'vs' : '@'} ${m.opp}</div><div class="th-comp">${m.leagueName}</div></div>
        <div style="text-align:right">
          <div class="th-score" style="color:var(--yellow)">${m.g.time}</div>
          <div class="th-date">${m.g.date || ''}</div>
        </div>
      </div>`;
    });
  }
  html += `</div>`;
  document.getElementById('th-inner').innerHTML = html;
  document.getElementById('teamHistoryOverlay').classList.add('open');
}
function closeTeamHistory() { document.getElementById('teamHistoryOverlay').classList.remove('open'); }
function handleTHClick(e) {
  if (!document.getElementById('teamHistoryPanel').contains(e.target)) closeTeamHistory();
}

// ‚îÄ‚îÄ‚îÄ NEWS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function fetchNews() {
  const mins = m => m < 60 ? m + 'm ago' : Math.floor(m/60) + 'h ago';
  allNews = [
    {id:1,category:'transfers',url:'https://www.skysports.com/football/transfer',imgGrad:'linear-gradient(135deg,#0f2744,#1a4a7a)',headline:"Mbapp√© linked with shock return to Ligue 1 amid Real Madrid exit rumours",snippet:"French forward's relationship with the Bernab√©u hierarchy has reportedly soured.",source:'Sky Sports',sourceIcon:'üì°',time:mins(4),breaking:true,tags:['Mbapp√©','Real Madrid','Transfers']},
    {id:2,category:'results',url:'https://www.bbc.com/sport/football',imgGrad:'linear-gradient(135deg,#7f1717,#b22222)',headline:"Arsenal thrash Tottenham 4‚Äì1 in North London Derby",snippet:"Bukayo Saka registered a hat-trick and an assist in a dominant display.",source:'BBC Sport',sourceIcon:'üî¥',time:mins(18),breaking:false,tags:['Arsenal','Tottenham','Premier League']},
    {id:3,category:'rumours',url:'https://www.theathletic.com/football',imgGrad:'linear-gradient(135deg,#1a2e4a,#2a4a7a)',headline:"Man City eyeing ‚Ç¨90m move for Florian Wirtz as De Bruyne replacement",snippet:"Leverkusen have been informed City will trigger talks. Wirtz has 14 goals this season.",source:'The Athletic',sourceIcon:'‚ö´',time:mins(35),breaking:false,tags:['Man City','Wirtz','Bundesliga']},
    {id:4,category:'transfers',url:'https://x.com/FabrizioRomano',imgGrad:'linear-gradient(135deg,#003466,#1a5276)',headline:"Victor Osimhen completes ‚Ç¨85m permanent move to Chelsea",snippet:"The Nigerian striker impressed with 12 goals in 18 appearances on loan.",source:'Fabrizio Romano',sourceIcon:'‚úÖ',time:mins(52),breaking:false,tags:['Osimhen','Chelsea','Done Deal']},
    {id:5,category:'results',url:'https://www.espn.com/soccer/',imgGrad:'linear-gradient(135deg,#8b0000,#c00000)',headline:"Bayern Munich 3‚Äì2 Borussia Dortmund: Late Musiala wonder goal seals Klassiker",snippet:"Musiala curled home a stunning 89th-minute winner at the Allianz Arena.",source:'ESPN',sourceIcon:'üü†',time:mins(70),breaking:false,tags:['Bayern','Dortmund','Bundesliga']},
    {id:6,category:'rumours',url:'https://www.mundodeportivo.com',imgGrad:'linear-gradient(135deg,#2e0044,#5a0066)',headline:"Barcelona pursuing Lamine Yamal contract extension ‚Äî demands ‚Ç¨20m/year",snippet:"A significant wage gap remains as rival clubs circle the teenager.",source:'Mundo Deportivo',sourceIcon:'üì∞',time:mins(95),breaking:false,tags:['Yamal','Barcelona','Contract']},
    {id:7,category:'results',url:'https://www.gazzetta.it',imgGrad:'linear-gradient(135deg,#010e80,#0d2890)',headline:"Inter Milan top Serie A after nervy 1‚Äì0 win over Napoli",snippet:"Lautaro Mart√≠nez's penalty proved the difference in a feisty San Siro encounter.",source:'La Gazzetta',sourceIcon:'üü£',time:mins(110),breaking:false,tags:['Inter','Napoli','Serie A']},
    {id:8,category:'transfers',url:'https://www.theguardian.com/football',imgGrad:'linear-gradient(135deg,#006600,#004400)',headline:"Liverpool agree ¬£65m fee for Real Sociedad's Martin Zubimendi",snippet:"Arne Slot has made the Spain international his top midfield target.",source:'The Guardian',sourceIcon:'üîµ',time:mins(140),breaking:false,tags:['Liverpool','Zubimendi','Transfers']},
  ];
  newsLoaded = true;
  document.getElementById('news-badge').style.display = 'inline';
  renderNews();
}
function renderNews() {
  let items = newsCategory === 'all' ? allNews : allNews.filter(n => n.category === newsCategory);
  if (!items.length) { document.getElementById('news-content').innerHTML = `<div class="news-empty">No ${newsCategory} news right now.</div>`; return; }
  document.getElementById('news-content').innerHTML = `<div class="news-feed">${items.map(n => `
    <div class="news-card ${n.breaking?'breaking':''}" onclick="window.open('${n.url}','_blank')">
      <div class="news-source-row">
        <div class="news-source-icon">${n.sourceIcon||'üì∞'}</div>
        <span class="news-source">${n.source}</span>
        <span style="color:var(--border2);margin:0 4px">¬∑</span>
        <span class="news-time">${n.time}</span>
        ${n.breaking?`<span class="news-breaking-tag" style="margin-left:auto">BREAKING</span>`:''}
      </div>
      <div class="news-headline">${n.headline}</div>
      <div class="news-snippet">${n.snippet}</div>
      <div class="news-tags">${(n.tags||[]).map(t=>`<span class="news-tag">${t}</span>`).join('')}</div>
      <div style="margin-top:8px;font-size:10px;color:var(--accent);font-weight:600">READ ON ${n.source.toUpperCase()} ‚Üó</div>
    </div>`).join('')}</div>`;
}
function filterNews(cat, el) {
  newsCategory = cat;
  document.querySelectorAll('.news-cat-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  if (!newsLoaded) fetchNews(); else renderNews();
}
function closeNewsArticle() {}
function handleNAClick() {}

// ‚îÄ‚îÄ‚îÄ H2H ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function seededRand(seed) {
  let s = 0; for (let i = 0; i < seed.length; i++) s = (s*31+seed.charCodeAt(i))&0x7fffffff;
  return () => { s=(s*1664525+1013904223)&0x7fffffff; return s/0x7fffffff; };
}
function renderH2H(homeName, awayName, hc, ac) {
  const rng = seededRand(homeName + awayName + 'h2h');
  let homeWins=0, awayWins=0, draws=0;
  const meetings = Array.from({length:6},(_,i)=>{
    const s1=Math.floor(rng()*4), s2=Math.floor(rng()*4);
    if(s1>s2)homeWins++; else if(s2>s1)awayWins++; else draws++;
    return{s1,s2,date:['Nov 2025','Apr 2025','Oct 2024','Apr 2024','Nov 2023','Apr 2023'][i]};
  });
  const t = meetings.length||1;
  return `<div class="h2h-wrapper">
    <div class="h2h-header">
      <div class="h2h-team"><div class="h2h-team-name" style="color:${hc}">${homeName.split(' ')[0]}</div><div class="h2h-team-stat" style="color:${hc}">${homeWins}</div><div class="h2h-label">Wins</div></div>
      <div style="text-align:center"><div class="h2h-vs">VS</div><div class="h2h-team-stat" style="color:var(--muted)">${draws}</div><div class="h2h-label">Draws</div></div>
      <div class="h2h-team"><div class="h2h-team-name" style="color:${ac}">${awayName.split(' ')[0]}</div><div class="h2h-team-stat" style="color:${ac}">${awayWins}</div><div class="h2h-label">Wins</div></div>
    </div>
    <div class="h2h-bar-row" style="margin-bottom:14px">
      <div class="h2h-bar-seg" style="background:${hc};width:${(homeWins/t*100).toFixed(0)}%"></div>
      <div class="h2h-bar-seg" style="background:var(--border2);width:${(draws/t*100).toFixed(0)}%"></div>
      <div class="h2h-bar-seg" style="background:${ac};width:${(awayWins/t*100).toFixed(0)}%"></div>
    </div>
    ${meetings.map(m=>`<div class="h2h-match">
      <div class="h2h-home" style="${m.s1>m.s2?`font-weight:700;color:${hc}`:''}">${homeName}</div>
      <div><div class="h2h-score ${m.s1>m.s2?'h2h-win-home':m.s2>m.s1?'h2h-win-away':'h2h-draw'}">${m.s1} ‚Äì ${m.s2}</div><div class="h2h-date">${m.date}</div></div>
      <div class="h2h-away" style="${m.s2>m.s1?`font-weight:700;color:${ac}`:''}">${awayName}</div>
    </div>`).join('')}
  </div>`;
}

// ‚îÄ‚îÄ‚îÄ MATCH MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function openMatchDetail(lk, gi) {
  const L = LEAGUES[lk];
  const g = L?.games[gi];
  if (!g) return;
  currentModalGame = { lk, gi, g, L };
  activeModalTab = 'overview';
  const hc = g.hColor || getColor(g.home);
  const ac = g.aColor || getColor(g.away);
  const isFT = g.status==='FT', isLive = g.status==='LIVE', isSCH = g.status==='SCH';

  document.getElementById('modal-inner').innerHTML = buildModalHeader(g, L, hc, ac);
  document.getElementById('modal-tabs-bar').innerHTML = '';
  document.getElementById('modal-body').innerHTML =
    '<div class="loading-overlay"><div class="spinner"></div><div class="loading-text">Loading match data...</div></div>';
  document.getElementById('matchModal').classList.add('open');
  document.body.style.overflow = 'hidden';

  // Always re-fetch summary for live/FT
  const slug = LEAGUE_CONFIG[lk]?.slug;
  const summaryPath = `/apis/site/v2/sports/soccer/${slug}/summary?event=${g.matchId}`;
  if (isLive || isFT) delete apiCache[summaryPath];

  let espnEvents = [], lineupData = null, detailFetchFailed = false;

  try {
    const summary = await apiFetch(summaryPath);

    // ‚îÄ‚îÄ Fresh live score from summary header ‚îÄ‚îÄ
    if (isLive && summary.header?.competitions?.[0]) {
      const sc = summary.header.competitions[0];
      const shome = sc.competitors?.find(c => c.homeAway === 'home');
      const saway = sc.competitors?.find(c => c.homeAway === 'away');
      if (shome) g.hs = parseInt(shome.score) ?? g.hs;
      if (saway) g.as = parseInt(saway.score) ?? g.as;
      g.elapsed = sc.status?.clock ? Math.floor(sc.status.clock / 60) : g.elapsed;
      document.getElementById('modal-inner').innerHTML = buildModalHeader(g, L, hc, ac);
      renderScores();
    }

    // ‚îÄ‚îÄ Events ‚Äî ESPN uses keyEvents or plays ‚îÄ‚îÄ
    espnEvents = summary.keyEvents || summary.keyPlays || [];

    // ‚îÄ‚îÄ Halftime score from boxscore ‚îÄ‚îÄ
    if (summary.boxscore?.teams) {
      const bHome = summary.boxscore.teams.find(t => t.homeAway === 'home');
      const bAway = summary.boxscore.teams.find(t => t.homeAway === 'away');
      if (bHome?.statistics) {
        const htH = bHome.statistics.find(s => s.name === 'halfTimeScore' || s.label === 'HT');
        const htA = bAway?.statistics?.find(s => s.name === 'halfTimeScore' || s.label === 'HT');
        if (htH && g.halftimeH === null) g.halftimeH = parseInt(htH.displayValue) ?? null;
        if (htA && g.halftimeA === null) g.halftimeA = parseInt(htA.displayValue) ?? null;
      }
    }

    // ‚îÄ‚îÄ Lineups from rosters ‚îÄ‚îÄ
    const rosters = summary.rosters || [];
    if (rosters.length > 0) {
      const hRoster = rosters.find(r => r.homeAway === 'home' || r.team?.id === g.hId) || rosters[0];
      const aRoster = rosters.find(r => r.homeAway === 'away' || r.team?.id === g.aId) || rosters[1] || null;
      const mapRoster = (r) => {
        if (!r?.athletes?.length) return [];
        return r.athletes
          .filter(a => a.starter)
          .map(a => ({
            name: a.athlete?.displayName || a.athlete?.shortName || '',
            pos:  a.athlete?.position?.abbreviation || '',
            num:  a.athlete?.jersey || '',
          }))
          .filter(p => p.name);
      };
      const hPlayers = mapRoster(hRoster);
      const aPlayers = mapRoster(aRoster);
      if (hPlayers.length || aPlayers.length) {
        lineupData = {
          home: { formation: hRoster?.formation || '', players: hPlayers },
          away: { formation: aRoster?.formation || '', players: aPlayers },
        };
      }
    }
  } catch(e) {
    detailFetchFailed = true;
    console.warn('Summary fetch failed:', e.message);
  }

  // ‚îÄ‚îÄ Parse ESPN events into goals, bookings, subs ‚îÄ‚îÄ
  const goals    = [], bookings = [], subs = [];
  espnEvents.forEach(e => {
    const typeText = (e.type?.text || e.type?.id || '').toLowerCase();
    const clock    = e.clock?.displayValue || e.time?.displayValue || '';
    const teamId   = e.team?.id;
    const min      = clock.replace("'", '').split(':')[0] || '?';

    if (typeText.includes('goal') || typeText === 'goal') {
      const scorer = e.participants?.find(p => p.type?.text?.toLowerCase().includes('scorer') || p.type?.id === 'scorer');
      const assist = e.participants?.find(p => p.type?.text?.toLowerCase().includes('assist') || p.type?.id === 'assist');
      goals.push({
        min, teamId,
        scorer: scorer?.athlete?.displayName || scorer?.athlete?.shortName || '',
        assist: assist?.athlete?.displayName || assist?.athlete?.shortName || '',
        isOG:   typeText.includes('own'),
        isPen:  typeText.includes('penalty') || typeText.includes('pen'),
      });
    } else if (typeText.includes('yellow') || typeText.includes('red') || typeText.includes('card')) {
      const player = e.participants?.[0]?.athlete?.displayName || '';
      bookings.push({ min, teamId, player, isRed: typeText.includes('red') });
    } else if (typeText.includes('subst') || typeText.includes('sub')) {
      const playerOn  = e.participants?.find(p => p.type?.id === 'subbedIn' || p.type?.text?.toLowerCase().includes('in'));
      const playerOff = e.participants?.find(p => p.type?.id === 'subbedOut' || p.type?.text?.toLowerCase().includes('out'));
      subs.push({ min, teamId,
        on:  playerOn?.athlete?.displayName  || '',
        off: playerOff?.athlete?.displayName || '',
      });
    }
  });

  // ‚îÄ‚îÄ Build tabs ‚îÄ‚îÄ
  document.getElementById('modal-tabs-bar').innerHTML = [
    {id:'overview',label:'Overview'},{id:'events',label:'Events'},
    {id:'lineups',label:'Lineups'},{id:'h2h',label:'H2H'},
  ].map(t => `<button class="modal-tab ${t.id==='overview'?'active':''}" data-tab="${t.id}" onclick="switchModalTab('${t.id}')">${t.label}</button>`).join('');

  let bodyHtml = '';

  // ‚îÄ‚îÄ OVERVIEW ‚îÄ‚îÄ
  bodyHtml += `<div class="tab-panel active" id="tab-overview"><div class="overview-grid">`;
  bodyHtml += `<div class="ov-card ov-card-full">
    <div class="ov-title">‚ÑπÔ∏è Match Info</div>
    <div style="font-size:12px;color:var(--text2);line-height:2">
      <div>üìÖ <strong style="color:var(--text)">${g.date} ¬∑ ${g.time}</strong></div>
      ${g.venue   ? `<div>üèüÔ∏è <strong style="color:var(--text)">${g.venue}</strong></div>` : ''}
      ${g.referee ? `<div>üëî <strong style="color:var(--text)">${g.referee}</strong></div>` : ''}
      <div>üèÜ <strong style="color:var(--text)">${L.name}</strong></div>
    </div>
  </div>`;

  if (isFT || isLive) {
    bodyHtml += `<div class="ov-card ov-card-full">
      <div class="ov-title">‚öΩ Goals</div>
      ${goals.length ? goals.map(go => {
        const isHome = go.teamId === g.hId;
        return `<div class="goal-line">
          <div class="goal-min">${go.min}'</div>
          <div class="goal-icon">${go.isOG ? 'üî¥' : '‚öΩ'}</div>
          <div>
            <div class="goal-player">${go.scorer}${go.isOG?' (OG)':''}${go.isPen?' (pen)':''}</div>
            <div class="goal-team">${isHome ? g.home : g.away}${go.assist ? ` ¬∑ Assist: ${go.assist}` : ''}</div>
          </div>
        </div>`;
      }).join('') : `<div style="color:var(--muted);font-size:12px;padding:4px 0">${isLive ? '‚è≥ No goals yet.' : 'No goals scored.'}</div>`}
    </div>`;

    if (g.hs !== null && g.as !== null) {
      bodyHtml += `<div class="ov-card">
        <div class="ov-title">${isFT ? 'Final Score' : 'Current Score'}</div>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:6px 0">
          <div style="text-align:center">
            <div style="background:${hc};width:36px;height:36px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;font-size:10px;font-weight:800;color:#fff;margin-bottom:4px">${g.hA.slice(0,3)}</div>
            <div style="font-size:11px;color:var(--text2)">${g.home.split(' ')[0]}</div>
          </div>
          <div style="font-family:'Space Grotesk',sans-serif;font-size:28px;font-weight:800;color:${isLive?'var(--live)':'var(--text)'}">${g.hs} ‚Äì ${g.as}</div>
          <div style="text-align:center">
            <div style="background:${ac};width:36px;height:36px;border-radius:8px;display:inline-flex;align-items:center;justify-content:center;font-size:10px;font-weight:800;color:#fff;margin-bottom:4px">${g.aA.slice(0,3)}</div>
            <div style="font-size:11px;color:var(--text2)">${g.away.split(' ')[0]}</div>
          </div>
        </div>
      </div>`;
    }
    if (g.halftimeH !== null && g.halftimeA !== null) {
      bodyHtml += `<div class="ov-card">
        <div class="ov-title">Half-Time</div>
        <div style="font-family:'Space Grotesk',sans-serif;font-size:24px;font-weight:700;text-align:center;color:var(--text2);padding:8px 0">${g.halftimeH} ‚Äì ${g.halftimeA}</div>
      </div>`;
    }
    if (bookings.length) {
      bodyHtml += `<div class="ov-card ov-card-full">
        <div class="ov-title">üü® Cards</div>
        ${bookings.map(b => `<div class="goal-line">
          <div class="goal-min" style="color:${b.isRed?'var(--red)':'var(--yellow)'}">${b.min}'</div>
          <div class="goal-icon">${b.isRed?'üü•':'üü®'}</div>
          <div><div class="goal-player">${b.player}</div><div class="goal-team">${b.teamId===g.hId?g.home:g.away}</div></div>
        </div>`).join('')}
      </div>`;
    }
  } else {
    bodyHtml += `<div class="ov-card ov-card-full">
      <div class="ov-title">üìÖ Upcoming</div>
      <div style="font-size:13px;color:var(--text2);line-height:1.9">
        <div>Kick-off: <strong style="color:var(--accent)">${g.time} ¬∑ ${g.date}</strong></div>
        <div style="margin-top:10px;display:flex;justify-content:space-between;align-items:center">
          <div style="text-align:center">
            <div style="background:${hc};width:44px;height:44px;border-radius:10px;display:inline-flex;align-items:center;justify-content:center;font-weight:800;color:#fff;font-size:12px;margin-bottom:5px">${g.hA.slice(0,3)}</div>
            <div style="font-size:11px;color:var(--text2)">${g.home}</div>
          </div>
          <div style="font-size:18px;font-weight:700;color:var(--muted)">vs</div>
          <div style="text-align:center">
            <div style="background:${ac};width:44px;height:44px;border-radius:10px;display:inline-flex;align-items:center;justify-content:center;font-weight:800;color:#fff;font-size:12px;margin-bottom:5px">${g.aA.slice(0,3)}</div>
            <div style="font-size:11px;color:var(--text2)">${g.away}</div>
          </div>
        </div>
      </div>
    </div>`;
  }
  bodyHtml += `</div></div>`;

  // ‚îÄ‚îÄ EVENTS ‚îÄ‚îÄ
  bodyHtml += `<div class="tab-panel" id="tab-events"><div class="events-wrapper">`;
  if (isSCH) {
    bodyHtml += `<div class="empty-state" style="padding:40px"><div style="font-size:24px;margin-bottom:10px">‚è∞</div>
      <div style="font-size:12px;color:var(--muted)">Match hasn't started yet.</div></div>`;
  } else if (detailFetchFailed) {
    bodyHtml += `<div class="empty-state" style="padding:40px"><div style="font-size:24px;margin-bottom:10px">‚ö†Ô∏è</div>
      <div style="font-size:12px;color:var(--muted)">Could not load event data ‚Äî try again in a moment.</div></div>`;
  } else if (!espnEvents.length) {
    bodyHtml += `<div class="empty-state" style="padding:40px"><div style="font-size:24px;margin-bottom:10px">üìã</div>
      <div style="font-size:12px;color:var(--muted)">${isLive ? 'No events yet ‚Äî updates every 60s.' : 'No event data available for this match.'}</div></div>`;
  } else {
    let htInserted = false;
    bodyHtml += `<div class="timeline">`;
    espnEvents.forEach(e => {
      const typeText = (e.type?.text || '').toLowerCase();
      const clock = e.clock?.displayValue || '';
      const minNum = parseInt(clock) || 0;
      const isHome = e.team?.id === g.hId;

      if (!htInserted && minNum > 45 && (isFT || isLive)) {
        htInserted = true;
        bodyHtml += `<div class="tl-item" style="pointer-events:none">
          <div class="tl-home"></div>
          <div class="tl-minute"><div style="font-size:9px;font-weight:700;letter-spacing:1px;text-transform:uppercase;position:relative;z-index:1;background:var(--bg);padding:0 4px">HT</div></div>
          <div class="tl-away"></div>
        </div>`;
      }

      let icon, playerName, subLine, tClass;
      if (typeText.includes('goal')) {
        icon = typeText.includes('own') ? 'üî¥' : '‚öΩ';
        const scorer = e.participants?.find(p => p.type?.text?.toLowerCase().includes('scor'));
        playerName = scorer?.athlete?.displayName || '';
        const assist = e.participants?.find(p => p.type?.text?.toLowerCase().includes('assist'));
        subLine = assist ? `Assist: ${assist.athlete?.displayName}` : '';
        tClass = 'goal';
      } else if (typeText.includes('yellow')) {
        icon = 'üü®'; playerName = e.participants?.[0]?.athlete?.displayName || ''; subLine = ''; tClass = 'yellow-card';
      } else if (typeText.includes('red')) {
        icon = 'üü•'; playerName = e.participants?.[0]?.athlete?.displayName || ''; subLine = ''; tClass = 'red-card';
      } else if (typeText.includes('sub')) {
        icon = 'üîÑ';
        const on  = e.participants?.find(p => p.type?.text?.toLowerCase().includes('in'));
        const off = e.participants?.find(p => p.type?.text?.toLowerCase().includes('out'));
        playerName = `‚Üë ${on?.athlete?.displayName || ''}`;
        subLine = `‚Üì ${off?.athlete?.displayName || ''}`;
        tClass = 'sub';
      } else return;

      const evHtml = `<div class="tl-event">
        <div class="tl-event-icon">${icon}</div>
        <div class="tl-event-player">${playerName}</div>
        ${subLine ? `<div class="tl-event-sub-out">${subLine}</div>` : ''}
      </div>`;
      bodyHtml += `<div class="tl-item">
        <div class="tl-home">${isHome  ? evHtml : ''}</div>
        <div class="tl-minute ${tClass}">${clock}</div>
        <div class="tl-away">${!isHome ? evHtml : ''}</div>
      </div>`;
    });
    bodyHtml += `</div>`;
  }
  bodyHtml += `</div></div>`;

  // ‚îÄ‚îÄ LINEUPS ‚îÄ‚îÄ
  bodyHtml += `<div class="tab-panel" id="tab-lineups">`;
  if (!lineupData || (!lineupData.home?.players?.length && !lineupData.away?.players?.length)) {
    const msg = detailFetchFailed ? 'Could not load lineup data ‚Äî try again in a moment.'
      : isFT ? 'Lineup data not available for this match.'
      : isLive ? 'Lineups not released yet.'
      : 'Lineups not yet announced. They usually appear 1 hour before kick-off.';
    bodyHtml += `<div class="empty-state" style="padding:40px"><div style="font-size:24px;margin-bottom:10px">üìã</div>
      <div style="font-size:12px;color:var(--muted)">${msg}</div></div>`;
  } else {
    const pt = (lineup, clr, teamName) => {
      if (!lineup?.players?.length) return '';
      return `<div class="pstats-wrapper">
        <div class="pstats-title" style="color:${clr}">${teamName}${lineup.formation ? ' ¬∑ ' + lineup.formation : ''}</div>
        <table class="ptable">
          <thead><tr><th>#</th><th>Player</th><th>Pos</th></tr></thead>
          <tbody>${lineup.players.map(p => `<tr>
            <td style="color:var(--muted)">${p.num||''}</td>
            <td><span class="p-name">${p.name}</span></td>
            <td style="color:var(--muted)">${p.pos||''}</td>
          </tr>`).join('')}</tbody>
        </table>
      </div>`;
    };
    bodyHtml += `<div style="padding:14px">
      ${pt(lineupData.home, hc, g.home)}
      <div style="height:14px"></div>
      ${pt(lineupData.away, ac, g.away)}
    </div>`;
  }
  bodyHtml += `</div>`;

  bodyHtml += `<div class="tab-panel" id="tab-h2h">${renderH2H(g.home, g.away, hc, ac)}</div>`;
  document.getElementById('modal-body').innerHTML = bodyHtml;
}

function buildModalHeader(g, L, hc, ac) {
  const isFT=g.status==='FT', isLive=g.status==='LIVE', isSCH=g.status==='SCH';
  return `<div class="modal-header">
    <button class="modal-close" onclick="closeMatchDetail()">‚úï</button>
    <div class="modal-league-info"><span class="flag">${L.flag}</span><span class="league-name">${L.name} ¬∑ ${L.country}</span></div>
    <div class="match-hero">
      <div class="mh-team">
        <div class="mh-badge" style="background:${hc}">${g.hA.slice(0,3)}</div>
        <div class="mh-name">${g.home}</div>
      </div>
      <div class="mh-score-center">
        ${isSCH ? `<div style="font-family:'Orbitron',sans-serif;font-size:13px;font-weight:700;color:var(--muted);letter-spacing:3px">VS</div>
          <div style="font-size:11px;color:var(--yellow);font-weight:600;margin-top:6px">‚è∞ ${g.time} ¬∑ ${g.date}</div>` :
          `<div class="mh-score ${isLive?'live':''}"><span>${g.hs !== null ? g.hs : '‚Äì'}</span><span class="sdash">‚Äì</span><span>${g.as !== null ? g.as : '‚Äì'}</span></div>
          <div class="mh-status ${isFT?'ft':isLive?'live':'sch'}">${isFT?'Full Time':isLive?`‚óè LIVE ${getLiveMinute(g)}`:''}</div>
          ${isFT&&g.halftimeH!==null?`<div class="mh-ht">HT: ${g.halftimeH}‚Äì${g.halftimeA}</div>`:''}`}
      </div>
      <div class="mh-team">
        <div class="mh-badge" style="background:${ac}">${g.aA.slice(0,3)}</div>
        <div class="mh-name">${g.away}</div>
      </div>
    </div>
    <div class="modal-meta">
      ${g.venue?`<span>üèüÔ∏è ${g.venue}</span>`:''}
      ${g.referee?`<span>üëî ${g.referee}</span>`:''}
    </div>
  </div>`;
}

function closeMatchDetail() { document.getElementById('matchModal').classList.remove('open'); document.body.style.overflow=''; }
function handleModalClick(e) { if(e.target===e.currentTarget||e.target.classList.contains('modal-backdrop'))closeMatchDetail(); }
function switchModalTab(tab) {
  activeModalTab=tab;
  document.querySelectorAll('.modal-tab').forEach(t=>t.classList.toggle('active',t.dataset.tab===tab));
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.toggle('active',p.id==='tab-'+tab));
}

// ‚îÄ‚îÄ‚îÄ CONTROLS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function switchMainTab(tab,el) {
  mainTab=tab;
  document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('panel-scores').style.display    = tab==='scores'?'':'none';
  document.getElementById('panel-standings').style.display = tab==='standings'?'':'none';
  document.getElementById('panel-news').style.display      = tab==='news'?'':'none';
  if(tab==='standings') renderStandings();
  if(tab==='news'){document.getElementById('news-badge').style.display='none';if(!newsLoaded)fetchNews();else renderNews();}
}
function filterLeague(league,el) {
  activeLeague=league;
  document.querySelectorAll('.sidebar-item').forEach(i=>i.classList.remove('active'));
  el.classList.add('active');
  if(mainTab==='scores')renderScores();
}
function setDateFilter(filter,el) {
  dateFilter=filter;
  document.querySelectorAll('.date-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  renderScores();
}
async function refreshAll() {
  const btn=document.getElementById('btn-refresh');
  btn.disabled=true; btn.textContent='‚Üª Refreshing...';
  Object.keys(apiCache).forEach(k => { if(k.includes('/scoreboard')||k.includes('/summary')) delete apiCache[k]; });
  dataLoaded=false; LEAGUES={};
  await loadFixtures();
  countdown = getRefreshInterval();
  const el = document.getElementById('countdown');
  if(el) el.textContent = countdown;
  btn.disabled=false; btn.textContent='‚Üª Refresh';
}
function getRefreshInterval() {
  return Object.values(LEAGUES).some(L => L.games.some(g => g.status === 'LIVE')) ? 60 : 180;
}
function startCountdown() {
  clearInterval(countdownTimer);
  countdown = getRefreshInterval();
  countdownTimer = setInterval(() => {
    countdown--;
    const el = document.getElementById('countdown');
    if(el) el.textContent = countdown;
    if(countdown <= 0) {
      countdown = getRefreshInterval();
      Object.keys(apiCache).forEach(k => { if(k.includes('/scoreboard')) delete apiCache[k]; });
      dataLoaded=false; LEAGUES={};
      loadFixtures();
    }
  }, 1000);
}

document.addEventListener('keydown',e=>{if(e.key==='Escape'){closeMatchDetail();closeTeamHistory();}});

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
loadFixtures();
startCountdown();
</script>

</body>
</html>
